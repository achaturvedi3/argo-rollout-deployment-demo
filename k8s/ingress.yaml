apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: canary-demo-ingress
  namespace: default
  annotations:
    # NGINX Ingress Controller annotations
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/rewrite-target: /
    
    # SSL/TLS (optional - uncomment if using HTTPS)
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
    
    # Canary annotations (managed by Argo Rollouts)
    # These will be automatically updated during rollout
    nginx.ingress.kubernetes.io/canary: "false"
    
    # Additional settings
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "false"
spec:
  rules:
  - host: canary-demo.example.com  # Update with your domain
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: canary-demo-stable
            port:
              number: 80
  # TLS configuration (optional)
  # tls:
  # - hosts:
  #   - canary-demo.example.com
  #   secretName: canary-demo-tls

---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: canary-demo-ingress-canary
  namespace: default
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/rewrite-target: /
    
    # Canary-specific annotations
    nginx.ingress.kubernetes.io/canary: "true"
    nginx.ingress.kubernetes.io/canary-weight: "0"
    
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "false"
spec:
  rules:
  - host: canary-demo.example.com  # Update with your domain
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: canary-demo-canary
            port:
              number: 80
